$.fn.editableTableWidget=function(m){return $(this).each(function(){var g=$.extend(function(){var a=$.extend({},$.fn.editableTableWidget.defaultOptions);a.editor=a.editor.clone();return a}(),m),e=$(this),c=g.editor.css("position","absolute").hide().appendTo(e.parent()),b,f=function(a){b=e.find("td:focus");b.length&&(c.val(b.text()).removeClass("error").show().offset(b.offset()).css(b.css(g.cloneProperties)).width(b.width()).height(b.height()).focus(),a&&c.select())},k=function(){var a=c.val(),d=$.Event("change"),
h;if(b.text()===a||c.hasClass("error"))return!0;h=b.html();b.text(a).trigger(d,a);!1===d.result&&b.html(h)},l=function(a,b){return 39===b?a.next("td"):37===b?a.prev("td"):38===b?a.parent().prev().children().eq(a.index()):40===b?a.parent().next().children().eq(a.index()):[]};c.blur(function(){k();c.hide()}).keydown(function(a){if(13===a.which)k(),c.hide(),b.focus(),a.preventDefault(),a.stopPropagation();else if(27===a.which)c.val(b.text()),a.preventDefault(),a.stopPropagation(),c.hide(),b.focus();
else if(9===a.which)b.focus();else if(this.selectionEnd-this.selectionStart===this.value.length){var d=l(b,a.which);0<d.length&&(d.focus(),a.preventDefault(),a.stopPropagation())}}).on("input paste",function(){var a=$.Event("validate");b.trigger(a,c.val());!1===a.result?c.addClass("error"):c.removeClass("error")});e.on("click keypress dblclick",f).css("cursor","pointer").keydown(function(a){var b=!0,c=l($(a.target),a.which);0<c.length?c.focus():13===a.which?f(!1):(17!==a.which&&91!==a.which&&93!==
a.which||f(!0),b=!1);b&&(a.stopPropagation(),a.preventDefault())});e.find("td").prop("tabindex",1);$(window).on("resize",function(){c.is(":visible")&&c.offset(b.offset()).width(b.width()).height(b.height())})})};$.fn.editableTableWidget.defaultOptions={cloneProperties:"padding padding-top padding-bottom padding-left padding-right text-align font font-size font-family font-weight border border-top border-bottom border-left border-right".split(" "),editor:$("<input>")};