function make_editable_table(e){e.editableTableWidget({editor:$('<input class="editable-table-input">')})}function get_csv(e){var t=[];return $.each(e.find("tr"),function(e,i){var n=[];$.each($(i).children("th,td"),function(e,t){n.push('"'+$(t).text().replace(/"/g,'""')+'"')}),t.push(n.join(","))}),t.join("\n")}$.fn.editableTableWidget=function(e){"use strict";return $(this).each(function(){var t,i=function(){var e=$.extend({},$.fn.editableTableWidget.defaultOptions);return e.editor=e.editor.clone(),e},n=$.extend(i(),e),a=37,o=38,r=39,d=40,l=13,s=27,c=9,h=$(this),f=n.editor.css("position","absolute").hide().appendTo(h.parent()),u=function(e){t=h.find("td:focus"),t.length&&(f.val(t.text()).removeClass("error").show().offset(t.offset()).css(t.css(n.cloneProperties)).width(t.width()).height(t.height()).focus(),e&&f.select())},p=function(){var e,i=f.val(),n=$.Event("change");return!(t.text()!==i&&!f.hasClass("error"))||(e=t.html(),t.text(i).trigger(n,i),void(n.result===!1&&t.html(e)))},b=function(e,t){return t===r?e.next("td"):t===a?e.prev("td"):t===o?e.parent().prev().children().eq(e.index()):t===d?e.parent().next().children().eq(e.index()):[]};f.blur(function(){p(),f.hide()}).keydown(function(e){if(e.which===l)p(),f.hide(),t.focus(),e.preventDefault(),e.stopPropagation();else if(e.which===s)f.val(t.text()),e.preventDefault(),e.stopPropagation(),f.hide(),t.focus();else if(e.which===c)t.focus();else if(this.selectionEnd-this.selectionStart===this.value.length){var i=b(t,e.which);i.length>0&&(i.focus(),e.preventDefault(),e.stopPropagation())}}).on("input paste",function(){var e=$.Event("validate");t.trigger(e,f.val()),e.result===!1?f.addClass("error"):f.removeClass("error")}),h.on("click keypress dblclick",u).css("cursor","pointer").keydown(function(e){var t=!0,i=b($(e.target),e.which);i.length>0?i.focus():e.which===l?u(!1):17===e.which||91===e.which||93===e.which?(u(!0),t=!1):t=!1,t&&(e.stopPropagation(),e.preventDefault())}),h.find("td").prop("tabindex",1),$(window).on("resize",function(){f.is(":visible")&&f.offset(t.offset()).width(t.width()).height(t.height())})})},$.fn.editableTableWidget.defaultOptions={cloneProperties:["padding","padding-top","padding-bottom","padding-left","padding-right","text-align","font","font-size","font-family","font-weight","border","border-top","border-bottom","border-left","border-right"],editor:$("<input>")},$(".table-upload").on("uploaded.ir.upload",function(e,t){var i=$(this).parent().data("name"),n=i,a=$("#"+n);$.post("/c/table/import_table",{upload_id:t.upload_id,argument_name:i}).fail(function(e){a.find(".scrollable").html(e.responseJSON[i])}).success(function(e){a.html(e),make_editable_table(a.find(".editable-table"))})}),$("#arguments").on("updated.cc",function(){$(".editable-table").each(function(){var e=$(this),t=e.attr("id"),i=get_csv(e);$("[name="+t+"_csv]").val(i)})}),make_editable_table($(".editable-table"));
