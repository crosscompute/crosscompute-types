function get_geotable_adjective(e){var t="streets|light|dark|satellite|streets-satellite|wheatpaste|streets-basic|comic|outdoors|run-bike-hike|pencil|pirates|emerald|high-contrast".replace(/-/g,"[-_]");try{return RegExp("("+t+")_geotable").exec(e)[1].replace(/_/g,"-")}catch(e){return"streets"}}function draw_map(e,t){for(var a=e+"-map",i=e+"-table",o=L.mapbox.map(a,"mapbox."+get_geotable_adjective(e)),l=[],r=t[0],s=t[1],n=0;n<r.length;n++){var c,d=r[n],p=d[0],u=d[1],_=$.extend({color:"black",weight:2,opacity:.7,fillColor:"yellow",fillOpacity:.5},s,d[2]);switch(p){case 1:_.radius_in_meters?c=L.circle(u,_.radius_in_meters,_):(c=L.circleMarker(u,_),_.radius_in_pixels&&c.setRadius(+_.radius_in_pixels));break;case 2:c=L.polyline(u,_);break;case 3:c=L.multiPolyline(u,_)}c.geotable={table_id:i,tbody_id:i.replace("-table","-row")+n},c.on("click",function(e){var t=this.geotable,a=$("#"+t.tbody_id).show();$("#"+t.table_id+" tbody").not(a).hide(),$("#"+t.table_id).show(),L.DomEvent.stopPropagation(e)}),l.push(c)}l.length&&o.fitBounds(L.featureGroup(l).addTo(o).getBounds()).on("click",function(){$("#"+i).hide()})}$(".geotable-upload").on("uploaded.ir",function(e,t){var a=$(this).data("name"),i=a,o=$("#"+i);$.post(CC.geotable.import_url,{upload_id:t.upload_id,argument_name:a}).fail(function(e){o.find(".geotable-map").html(e.responseJSON[a])}).success(function(e){$("[name="+i+"]").val(t.upload_id),o.html(e);var l=o.find("script").text().replace(/'/g,'"'),r="[["+/(\[.*\]);/.exec(l)[1];draw_map(a,$.parseJSON(r))})});
