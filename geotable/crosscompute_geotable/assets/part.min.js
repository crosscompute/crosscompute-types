function get_geotable_adjective(e){var t="streets|light|dark|satellite|streets-satellite|wheatpaste|streets-basic|comic|outdoors|run-bike-hike|pencil|pirates|emerald|high-contrast".replace(/-/g,"[-_]");try{return RegExp("("+t+")_geotable").exec(e)[1].replace(/_/g,"-")}catch(e){return"streets"}}function draw_map(e,t){for(var a=e+"-map",i=e+"-table",o=L.mapbox.map(a,"mapbox."+get_geotable_adjective(e)),l=[],r=t[0],n=t[1],s=0;s<r.length;s++){var c,d=r[s],p=d[0],u=d[1],b=$.extend({color:"black",weight:2,opacity:.7,fillColor:"yellow",fillOpacity:.5},n,d[2]);switch(p){case 1:c=L.circleMarker(u,b),b.radius_in_pixels&&c.setRadius(+b.radius_in_pixels);break;case 2:c=L.polyline(u,b);break;case 3:c=L.multiPolyline(u,b)}c.geotable={table_id:i,tbody_id:i.replace("-table","-row")+s},c.on("click",function(e){var t=this.geotable,a=$("#"+t.tbody_id).show();$("#"+t.table_id+" tbody").not(a).hide(),$("#"+t.table_id).show(),L.DomEvent.stopPropagation(e)}),l.push(c)}l.length&&o.fitBounds(L.featureGroup(l).addTo(o).getBounds(),{animate:!1}).on("click",function(){$("#"+i).hide()})}$(".geotable-upload").on("uploaded.ir",function(e,t){var a=$(this),i=a.next(".feedback");i.text("Loading... Large datasets can take a few minutes");var o=$(this).data("name"),l=o,r=$("#"+l);$.post(CC.geotable.import_url,{upload_id:t.upload_id,argument_name:o}).fail(function(e){r.find(".geotable-map").html(e.responseJSON[o])}).success(function(e){r.html(e),$("[name="+l+"]").val(t.upload_id);var a=r.find("script").text().replace(/'/g,'"'),i="[["+/(\[.*\]);/.exec(a)[1];draw_map(o,$.parseJSON(i))}).always(function(){i.text("")})});
