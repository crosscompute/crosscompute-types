function get_geotable_adjective(e){var t="streets|light|dark|satellite|streets-satellite|wheatpaste|streets-basic|comic|outdoors|run-bike-hike|pencil|pirates|emerald|high-contrast".replace(/-/g,"[-_]");try{return RegExp("("+t+")_geotable").exec(e)[1].replace(/_/g,"-")}catch(e){return"streets"}}function draw_map(e,t){for(var a=e+"-map",i=e+"-table",l=L.mapbox.map(a,"mapbox."+get_geotable_adjective(e)),o=[],r=t[0],s=t[1],c=0;c<r.length;c++){var n,d=r[c],p=d[0],u=d[1],_=$.extend({color:"black",weight:2,opacity:.7,fillColor:"yellow",fillOpacity:.5},s,d[2]);switch(p){case 1:_.radius_in_meters?n=L.circle(u,_.radius_in_meters,_):(n=L.circleMarker(u,_),_.radius_in_pixels&&n.setRadius(_.radius_in_pixels));break;case 2:n=L.polyline(u,_);break;case 3:n=L.multiPolyline(u,_)}n.geotable={table_id:i,tbody_id:i.replace("-table","-row")+c},n.on("click",function(){var e=this.geotable,t=$("#"+e.tbody_id).show();$("#"+e.table_id+" tbody").not(t).hide(),$("#"+e.table_id).show()}),o.push(n)}o.length&&l.fitBounds(L.featureGroup(o).addTo(l).getBounds()).on("click",function(){$("#"+i).hide()})}$(".geotable-upload").on("uploaded.ir.upload",function(e,t){var a=$(this).parent().data("name"),i=a,l=$("#"+i);$.post("/c/geotable/import_geotable",{upload_id:t.upload_id,argument_name:a}).fail(function(e){l.find(".geotable-map").html(e.responseJSON[a])}).success(function(e){$("[name="+i+"]").val(t.upload_id),l.html(e);var o=l.find("script").text().replace(/'/g,'"'),r="[["+/(\[.*\]);/.exec(o)[1];draw_map(a,$.parseJSON(r))})});
